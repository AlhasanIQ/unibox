(function(a){a.fn.unibox=function(b){var d=this;var c=a.extend({suggestUrl:"",queryVisualizationHeadline:"",highlight:true,throttleTime:300,animationSpeed:300,enterCallback:undefined,minChars:2,maxWidth:d.outerWidth()},b);UniBox.init(d,c);return this}}(jQuery));var UniBox=function(){var b=-1;var p;var h;var a="";var g;var m=[];var d=true;var f=300;var c="";var l=2;var e;function q(r){if(r!==undefined){var s=p.val();if(r.keyCode==13){}if(r.keyCode==9||r.keyCode==13||s.length<l){h.slideUp(f);b=-1}}else{h.slideUp(f);b=-1}}function o(s,r){var t=null;return function(){var v=this,u=arguments;clearTimeout(t);t=window.setTimeout(function(){s.apply(v,u)},r||500)}}function j(s,r){if(!d){return s}var u=r.split(" ");var t={};$.each(u,function(v,w){if(w.length<2){return}s=s.replace(new RegExp(w,"gi"),"##"+v+"##");t["##"+v+"##"]="<span>"+w+"</span>"});$.each(t,function(v,w){s=s.replace(new RegExp(v,"gi"),w)});return s}function i(s){s=JSON.parse(s);var r=p.val();h.html("");$.each(s.suggests,function(u,t){if(u.replace(/_/,"").length>0&&t.length>0){var v=$("<h4>"+u+"</h4>");h.append(v)}$.each(t,function(w,z){var x='<div class="unibox-selectable">';if(z.image!=undefined){x+='<img src="'+z.image+'"/>'}if(z.link!=undefined){x+='<a href="'+z.link+'">';x+=j(z.name,r);x+="</a>"}else{x+=j(z.name,r)}x+='<div class="unibox-ca"></div></div>';var y=$(x);h.append(y)})});if(s.words.length>0&&c.length>0){h.append("<h4>"+c+"</h4>")}$.each(s.words,function(t,u){if(u.overlayImage!=undefined){h.append('<img class="unibox-vis" src="'+u.overlayImage+'" style="background-image: url(\''+u.image+"');background-size: 75%;background-repeat: no-repeat;background-position: center;\">")}else{h.append('<img class="unibox-vis" src="'+u.image+'">')}});h.css("position","absolute");h.css("left",p.offset().left);h.css("top",p.offset().top+p.height());h.slideDown(f);m=$(".unibox-selectable");b=-1}function k(s){if(s.keyCode!=38&&s.keyCode!=40&&s.keyCode!=13){return}if(s.keyCode==38&&b>0){b--}else{if(s.keyCode==40){b++}}if(m.length>0){b=b%m.length;m.removeClass("active");var r=$(m[b]);r.addClass("active")}if(s.keyCode==13&&b!=-1){if(e!=undefined){e()}else{window.location.href=$($(".unibox-selectable.active")[0]).find("a").attr("href")}return false}}function n(r){if(r.keyCode==38||r.keyCode==40){return}var s=p.val();if(s.length>=l){$.get(a+encodeURIComponent(s),function(t){i(t)})}}return{init:function(s,r){p=s;d=r.highlight;a=r.suggestUrl;g=r.throttleTime;f=r.animationSpeed;l=r.minChars;e=r.enterCallback;c=r.queryVisualizationHeadline;p.attr("autocomplete","off");h=$('<div id="unibox-suggest-box"></div>');$("body").append(h);h.css("min-width",p.outerWidth());h.css("max-width",r.maxWidth);p.keydown(k);p.keydown(o(n,g));p.keydown(q);p.keyup(q);$("html").click(function(){h.slideUp(f)});h.click(function(t){t.stopPropagation()});console.log("unibox initialized")}}}();